name: Collecte Bourse Fondamentale

on:
  schedule:
    - cron: '45 16 * * 1-5' # Exécution à 16h45 UTC (du lundi au vendredi)
  workflow_dispatch:      # Permet le lancement manuel via l'onglet Actions

jobs:
  run_script:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install dependencies
        # Ajout de numpy pour corriger l'erreur JSON "Out of range float"
        run: |
          python -m pip install --upgrade pip
          pip install pandas requests beautifulsoup4 lxml supabase numpy

      - name: Run script
        # Le script utilise les clés intégrées directement dans le code
        run: python collecte_bourse.py

      - name: Upload artifacts if failure
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: logs-erreur
          path: ./*.log
